<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Legado Guevara-J√°uregui: Documental Interactivo</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Cinzel (Display) & Cormorant Garamond (Body) -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Cormorant+Garamond:ital,wght@0,500;0,700;1,500&display=swap" rel="stylesheet">
    
    <!-- TAILWIND CONFIGURATION FOR CUSTOM PALETTE -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'paper': '#f7f1e3',
                        'ink': '#1a1a1a',
                        'gold': '#c5a059',
                        'forest': '#1b3a2b',
                        'wine': '#631818'
                    },
                    fontFamily: {
                        'display': ['"Cinzel"', 'serif'],
                        'body': ['"Cormorant Garamond"', 'serif'],
                    }
                }
            }
        }
    </script>
    
    <!-- AOS CSS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Draggable.min.js"></script>
    
    <style>
        /* --- ESTILOS REVISADOS CON PALETA ORIGINAL SOLICITADA --- */

        /* ESTILOS BASE */
        body { 
            background-color: #f7f1e3; /* paper */
            color: #1a1a1a; /* ink */
            overflow-x: hidden; 
            font-family: 'Cormorant Garamond', serif;
        }

        /* FIX: ELIMINACI√ìN DE SCROLL SNAP para evitar bloqueos */
        /* .snap-container {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        } */
        .section {
            min-height: 100vh; 
            width: 100%;
            /* Eliminado scroll-snap-align: start; */
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background-image: url("https://www.transparenttextures.com/patterns/cream-paper.png");
            border-bottom: 10px solid #1b3a2b; /* Separador forest */
        }
        .section.bg-ink {
            background-color: #1a1a1a;
            background-image: none; 
        }
        .section.bg-forest {
            background-color: #1b3a2b;
            background-image: none;
        }
        .section.bg-wine {
            background-color: #631818;
            background-image: none;
        }
        .section.bg-gold {
            background-color: #c5a059;
            background-image: none;
        }
        
        /* FIX DE SCROLL: Innecesario si eliminamos snap-container, pero se deja por si acaso */
        .section:nth-last-of-type(-n+3) { 
             scroll-snap-align: none;
        }


        /* TIPOGRAF√çA */
        .mega-title { font-size: clamp(4rem, 12vw, 12rem); line-height: 0.9; }
        h1, h2, h3, h4 { font-family: 'Cinzel', serif; }
        h2 { font-size: clamp(2.5rem, 5vw, 5rem); line-height: 1.1; margin-bottom: 1rem; color: #1b3a2b; }
        p { font-size: clamp(1.5rem, 2vw, 2rem); line-height: 1.6; margin-bottom: 1.5rem; max-width: 90%; }
        
        /* BOTONES ELEGANTES */
        .btn-action {
            background: #1a1a1a; color: #c5a059; border: 3px solid #c5a059; 
            padding: 1rem 3rem; font-family: "Cinzel"; font-weight: 900;
            font-size: 1.5rem; cursor: pointer; transition: all 0.3s;
            text-transform: uppercase; letter-spacing: 2px; border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2); margin-top: 1rem;
            display: inline-block; text-align: center;
        }
        .btn-action:hover { background: #c5a059; color: #1a1a1a; border-color: #1a1a1a; transform: scale(1.05); }
        .btn-action:active { transform: scale(0.95); }
        
        /* Bot√≥n de Contexto/Audio */
        .btn-context {
            background: #1b3a2b; color: #c5a059; border: 2px solid #c5a059;
            padding: 0.5rem 1rem; font-size: 1rem; font-family: 'Cinzel', serif;
            font-weight: 700; transition: all 0.2s; border-radius: 6px; margin-top: 1rem;
            display: inline-flex; align-items: center; justify-content: center;
        }
        .btn-context:hover { background: #14532d; color: #f7f1e3; }

        /* TARJETAS DE JUEGO */
        .game-card {
            background: white; border: 4px solid #c5a059; padding: 3rem;
            border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            position: relative; z-index: 20; max-width: 1200px; w-full;
            text-align: center;
        }

        /* FEEDBACK VISUAL */
        .feedback-msg {
            font-size: 2rem; font-weight: bold; margin-top: 2rem;
            padding: 1rem; border-radius: 10px; display: none;
            animation: popIn 0.5s ease;
        }
        .feedback-success { background: #dcfce7; color: #166534; border: 2px solid #166534; }
        .feedback-error { background: #fee2e2; color: #991b1b; border: 2px solid #991b1b; }

        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        /* LOADER */
        #loader { position: fixed; inset: 0; background: #1b3a2b; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #f7f1e3; }
        
        /* Interactive element adjustments */
        .birth-item {
            /* Eliminado cursor:grab, usamos cursor:pointer para el click */
            cursor: pointer; 
            background-color: white; /* Por defecto en el pool */
            color: #1a1a1a; /* ink */
            border: 2px solid #c5a059;
            padding: 0.8rem 0.5rem;
            border-radius: 8px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            height: 60px; 
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: all 0.2s ease-in-out; /* Animaci√≥n para mover */
        }
        /* Estilos de estado al ser arrastrado o colocado */
        .birth-item.bg-green-700 { background-color: #1b3a2b; color: white; border-color: #f7f1e3; } /* En slot, Temporal */
        .birth-item.bg-red-700 { background-color: #631818; color: white; border-color: #f7f1e3; }
        .birth-item.bg-green-900 { background-color: #14532d; color: white; border-color: #f7f1e3; } /* En slot, Correcto */

        /* Contenedor de elementos para que quede claro el "pool" */
        #draggable-birth {
            border: 2px dashed #1b3a2b;
            padding: 1rem;
            border-radius: 10px;
            background-color: #fcf8f0;
        }
        
        /* Drop Targets */
        .drop-target {
            border: 3px dashed #c5a059;
            background-color: rgba(197, 160, 89, 0.1);
            min-height: 4rem;
            border-radius: 8px;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .drop-target span { 
            color: #1b3a2b; 
            font-weight: 700; 
            font-family: 'Cinzel', serif; 
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .drop-target .birth-item {
            width: 100%;
            height: auto;
            margin: 0;
            cursor: pointer;
        }
        
        /* Hitos options custom styling */
        .hitos-option-card {
            background: white;
            border: 3px dashed #1a1a1a;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            padding: 1rem;
        }
        .hitos-option-card:hover {
            background: #fffbef;
            border-color: #c5a059;
        }
        .hitos-option-card.selected {
            background: #c5a059;
            color: white;
            border-color: #1a1a1a;
            box-shadow: 0 0 15px rgba(197, 160, 89, 0.7);
        }
        
        /* Modal Style for "Saber M√°s" */
        .modal {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: #f7f1e3; color: #1a1a1a; padding: 40px; border-radius: 15px;
            max-width: 80%; max-height: 80%; overflow-y: auto; position: relative;
            box-shadow: 0 10px 30px rgba(197, 160, 89, 0.5);
        }
        .modal-close {
            position: absolute; top: 15px; right: 25px; font-size: 2rem; cursor: pointer; color: #631818;
        }

    </style>
</head>
<body class="font-body">

    <!-- MODAL (Ventana Saber M√°s) -->
    <div id="info-modal" class="modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h3 id="modal-title" class="font-display text-4xl mb-4 text-forest"></h3>
            <div id="modal-body" class="text-xl"></div>
        </div>
    </div>
    
    <!-- PANTALLA DE CARGA -->
    <div id="loader">
        <h2 class="font-display text-5xl animate-pulse tracking-widest text-center text-gold">CARGANDO HISTORIA...</h2>
        <div class="mt-8 w-64 h-3 bg-gold rounded-full"></div>
    </div>

    <!-- ELIMINADO EL SCROLL SNAP DEL CONTENEDOR PRINCIPAL -->
    <div class="h-screen overflow-y-scroll" id="main-content-scroll"> 

        <!-- 1. PORTADA -->
        <div class="section">
            <div class="text-center z-10 w-full">
                <p class="text-gold tracking-[0.3em] uppercase font-bold mb-8 text-2xl">Documental Interactivo</p>
                <h1 class="mega-title font-display text-forest mb-8">
                    GUEVARA<br><span class="text-gold font-body italic text-8xl">&</span><br>JAUREGUI
                </h1>
                <p class="text-gray-600 italic">"Desliza hacia abajo para comenzar el viaje"</p>
                <div class="animate-bounce text-gold mt-12 text-6xl"><i class="fas fa-chevron-down"></i></div>
            </div>
        </div>

        <!-- 2. ORIGENES GUEVARA -->
        <div class="section bg-forest text-paper">
            <div class="max-w-4xl w-full text-center">
                <span class="text-gold font-bold uppercase tracking-widest text-xl border-b-4 border-gold">Cap√≠tulo 1: El Linaje</span>
                <h2 class="text-white mt-6">Los Guevara y el Comercio</h2>
                <p class="text-gray-200">
                    El dato m√°s antiguo del linaje Guevara se remonta al a√±o 1826 con el matrimonio de Santiago Guevara y V√©lez de Mendiz√°bal con Gregoria √Ålvarez de Arcaya y D√≠az de Durana en Junguitu.
                    <br><br>
                    Su hijo, Telesforo Guevara y √Ålvarez de Arcaya (1843), consolid√≥ la familia en Vitoria como un pr√≥spero Confitero.
                </p>
                <div class="flex justify-center gap-4 mt-6">
                    <button class="btn-context" onclick="openModal('Telesforo: El Confitero', 'context-tele')">Saber M√°s sobre Telesforo</button>
                    <button class="btn-context" onclick="narrateChapter(this)">
                        <i class="fas fa-volume-up mr-2"></i> Audio
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 3. JUEGO 1: PRECIO -->
        <div class="section">
            <div class="grid lg:grid-cols-2 gap-16 items-center max-w-[1600px] w-full">
                <div>
                    <h3 class="font-display text-4xl mb-6 text-forest">Las Propiedades</h3>
                    <p class="text-gray-700">
                        Gracias a su negocio, Telesforo adquiri√≥ una casa en C/Barreras, 11 (1880) por 10.750 Ptas, y otra en C/Francia, n¬∫ 5 (1899) por 11.500 Ptas, adem√°s de fincas y un comercio en C/ Nueva Dentro.
                    </p>
                    <button class="btn-context" onclick="openModal('Patrimonio Telesforo', 'context-propiedades')">Ver Detalle del Patrimonio</button>
                </div>

                <div class="game-card text-ink">
                    <h3 class="font-display text-4xl mb-4 text-wine">üéÆ Desaf√≠o: El Precio Justo</h3>
                    <p class="text-2xl mb-8">¬øCu√°nto pag√≥ Telesforo por la casa de C/Barreras en 1880?</p>
                    
                    <input type="range" min="1000" max="20000" value="5000" class="w-full h-6 bg-gray-300 rounded-lg cursor-pointer mb-8 accent-gold" id="priceRange" oninput="updatePrice(this.value)">
                    <p class="text-6xl font-display font-bold text-forest mb-8"><span id="priceVal">5.000</span> Ptas</p>
                    
                    <button class="btn-action" onclick="checkPrice()">¬°Comprobar!</button>
                    <div id="fb-price" class="feedback-msg"></div>
                </div>
            </div>
        </div>
        
        <!-- 4. ORIGENES J√ÅUREGUI -->
        <div class="section bg-wine text-paper">
            <div class="max-w-4xl w-full text-center">
                <span class="text-gold font-bold uppercase tracking-widest text-xl border-b-4 border-gold">Cap√≠tulo 2: El Regalao</span>
                <h2 class="text-white mt-6">Pedro J√°uregui (1851-1930)</h2>
                <p class="text-gray-200">
                    El linaje J√°uregui se remonta a Raimundo J√°uregui Az√°ceta (Maestu, 1750). Su nieto, Pedro Valent√≠n J√°uregui Querejazu, era conocido como "El Regalao" por su vida de rentas. 
                </p>
                <p class="text-gray-200">
                    Fue una figura clave en Maestu: secretario de Ayuntamiento, diputado provincial, y hombre de confianza de Juan Arana.
                </p>
                <div class="flex justify-center gap-4 mt-6">
                    <button class="btn-context" onclick="openModal('Familia J√°uregui', 'context-jauregui')">Saber M√°s de Ascendientes</button>
                    <button class="btn-context" onclick="narrateChapter(this)">
                        <i class="fas fa-volume-up mr-2"></i> Audio
                    </button>
                </div>
            </div>
        </div>

        <!-- 5. JUEGO 2: HITOS -->
        <div class="section bg-forest text-paper">
            <div class="game-card text-ink">
                <h3 class="font-display text-4xl mb-6 text-forest">üéÆ Conecta la Historia</h3>
                <p class="text-2xl mb-8">¬øQu√© trajo Pedro a Maestu?</p>
                
                <div class="grid grid-cols-2 gap-6">
                    <div class="hitos-option-card text-ink" data-answer="asfalto" onclick="toggleHitos(this)">
                        <i class="fas fa-hammer text-5xl mb-2"></i>
                        <p class="font-bold">Minas de Asfalto</p>
                    </div>
                    <div class="hitos-option-card text-ink" data-answer="luz" onclick="toggleHitos(this)">
                        <i class="fas fa-lightbulb text-5xl mb-2"></i>
                        <p class="font-bold">Luz El√©ctrica</p>
                    </div>
                    <div class="hitos-option-card text-ink" data-answer="internet" onclick="toggleHitos(this)">
                        <i class="fas fa-wifi text-5xl mb-2"></i>
                        <p class="font-bold">Internet</p>
                    </div>
                    <div class="hitos-option-card text-ink" data-answer="tren" onclick="toggleHitos(this)">
                        <i class="fas fa-train text-5xl mb-2"></i>
                        <p class="font-bold">Tren Alta Velocidad</p>
                    </div>
                </div>
                <button class="btn-action mt-6" onclick="checkFinalConnect()">VERIFICAR</button>
                <div id="fb-connect" class="feedback-msg"></div>
            </div>
        </div>

        <!-- 6. TRAGEDIA DE GUADALUPE Y JOSEFINA -->
        <div class="section">
            <div class="max-w-4xl w-full text-center">
                <span class="text-forest font-bold uppercase tracking-widest text-xl border-b-4 border-forest">Cap√≠tulo 3: La Hu√©rfana</span>
                <h2 class="text-wine mt-6">La Muerte de Guadalupe</h2>
                <p class="text-gray-700">
                    Pedro y Valeriana Guadalupe Zumalde (1868-1901) tuvieron 3 hijos: Josefina (1893), Jos√© (1896) e In√©s (1899).
                    <br><br>
                    In√©s muri√≥ con apenas 1 a√±o. Guadalupe falleci√≥ en 1901 porque, seg√∫n contaban, "no pudo superar la tristeza" de perder a su hija.
                </p>
                <p class="text-2xl font-bold text-wine mt-6">
                    Nuestra abuela Josefina se qued√≥ hu√©rfana de madre con solo 7 a√±os, enfrentando una infancia infeliz con su madrastra, Elvira.
                </p>
                <div class="flex justify-center gap-4 mt-6">
                    <button class="btn-context" onclick="openModal('Infancia de Josefina', 'context-infancia')">Saber M√°s sobre la Infancia</button>
                    <button class="btn-context" onclick="narrateChapter(this)">
                        <i class="fas fa-volume-up mr-2"></i> Audio
                    </button>
                </div>
            </div>
        </div>

        <!-- 7. ENCUENTRO Y BODA -->
        <div class="section bg-ink text-paper">
            <div class="max-w-4xl w-full text-center">
                <span class="text-gold font-bold uppercase tracking-widest text-xl border-b-4 border-gold">Cap√≠tulo 4: 1916</span>
                <h2 class="text-gold mt-6">El Lujo de la Boda</h2>
                <p class="text-2xl text-white">
                    √Ångel (m√©dico de Zalduendo) y Josefina (en Vitoria) se conocieron. En marzo de 1916, √Ångel pidi√≥ su mano en matrimonio, asistiendo a la pedida en AUTOM√ìVIL.
                </p>
                <p class="text-2xl text-white">
                    Se casaron el 17 de noviembre de 1916 en la Bas√≠lica del Santo Cristo en Lezo (Gipuzkoa).
                </p>
                <div class="flex justify-center gap-4 mt-6">
                    <button class="btn-context" onclick="openModal('Ajuar y Viaje', 'context-ajuar')">Saber M√°s sobre Ajuar y Viaje</button>
                    <button class="btn-context" onclick="narrateChapter(this)">
                        <i class="fas fa-volume-up mr-2"></i> Audio
                    </button>
                </div>
                
                <!-- JUEGO 3: BODA -->
                <div class="game-card text-ink mt-16 mx-auto">
                    <h3 class="font-display text-4xl mb-4">üéÆ Pregunta R√°pida</h3>
                    <p class="text-2xl mb-6">¬øPor qu√© NO se casaron en Est√≠baliz?</p>
                    <div class="flex gap-4 justify-center">
                        <button class="btn-action bg-white text-ink hover:bg-forest hover:text-white" onclick="showFeedback('fb-wedding', true, '¬°Correcto! Estaba en restauraci√≥n.')">Estaba en Obras</button>
                        <button class="btn-action bg-white text-ink hover:bg-wine hover:text-white" onclick="showFeedback('fb-wedding', false, 'No, esa no fue la raz√≥n.')">Les ca√≠a mal el cura</button>
                    </div>
                    <div id="fb-wedding" class="feedback-msg"></div>
                </div>
            </div>
        </div>
        
        <!-- 8. LA GRAN TRAGEDIA DE 1918 -->
        <div class="section bg-wine text-paper">
            <div class="max-w-4xl w-full text-center">
                <span class="text-gold font-bold uppercase tracking-widest text-xl border-b-4 border-gold">Cap√≠tulo 5: El √âxodo</span>
                <h2 class="text-white text-7xl mb-8">1918: La Gripe y la Fuga</h2>
                <p class="text-3xl mb-8 font-light">
                    En Zalduendo nace su primer hijo, Jos√© (1917). Pero la alegr√≠a dura poco: en octubre de 1918, la Gripe Espa√±ola asola el hogar.
                </p>
                <p class="text-3xl mb-8 font-light">
                    En una sola noche fallecen el abuelo Telesforo y la sirvienta de la casa. El ni√±o Jos√© estuvo muy grave.
                </p>
                <p class="text-3xl font-light text-gold italic">
                    La familia huy√≥ de Zalduendo y se refugi√≥ en Vitoria en casa de la familia de Josefina.
                </p>
                <div class="flex justify-center gap-4 mt-6">
                    <button class="btn-context" onclick="openModal('Contexto de la Gripe', 'context-gripe')">Saber M√°s sobre la Gripe Espa√±ola</button>
                    <button class="btn-context" onclick="narrateChapter(this)">
                        <i class="fas fa-volume-up mr-2"></i> Audio
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 9. MUERTE DE FELIPA Y HIJOS -->
        <div class="section">
             <div class="max-w-4xl w-full text-center">
                <span class="text-forest font-bold uppercase tracking-widest text-xl border-b-4 border-forest">Cap√≠tulo 6: La Nueva Vida</span>
                <h2 class="text-forest text-7xl mb-8">Vitoria, Junguitu y el Dolor</h2>
                <p class="text-3xl mb-8 text-gray-700">
                    En Vitoria nace √Ångel (1920). Se trasladan a Junguitu. All√≠, en 1922, la madre de √Ångel, Felipa Ajuria, muere de pulmon√≠a por no poder conseguir la medicaci√≥n adecuada.
                </p>
                <p class="text-3xl mb-12 text-gray-700">
                    En Junguitu nacen Est√≠baliz (1922) y Luis Mar√≠a (1924).
                </p>

                <!-- JUEGO 5: CAUSA MUERTE FELIPA -->
                <div class="game-card mx-auto border-wine mb-12">
                    <h3 class="font-display text-4xl mb-4 text-wine">Desaf√≠o: Causa de la Muerte</h3>
                    <p class="text-2xl mb-6">¬øCu√°l fue la causa exacta del fallecimiento de Felipa Ajuria (madre de √Ångel) en 1922?</p>
                    <div class="flex flex-col gap-4 max-w-2xl mx-auto">
                        <button class="felipa-option btn-action w-full bg-white text-ink border-2 border-gray-300 hover:bg-forest hover:text-white" onclick="checkFelipa(false, this)">La Gripe Espa√±ola segu√≠a activa.</button>
                        <button class="felipa-option btn-action w-full bg-white text-ink border-2 border-gray-300 hover:bg-forest hover:text-white" onclick="checkFelipa(true, this)">Pulmon√≠a por falta de medicaci√≥n adecuada.</button>
                        <button class="felipa-option btn-action w-full bg-white text-ink border-2 border-gray-300 hover:bg-forest hover:text-white" onclick="checkFelipa(false, this)">Una complicaci√≥n por diabetes.</button>
                    </div>
                    <div id="fb-felipa" class="feedback-msg"></div>
                </div>
            </div>
        </div>

        <!-- 10. CASA IL√ÅRRAZA Y ORDENACI√ìN FINAL -->
        <div class="section bg-forest text-paper">
            <div class="max-w-[1400px] w-full text-center">
                <span class="text-gold font-bold uppercase tracking-widest text-xl border-b-4 border-gold">Cap√≠tulo 7: La Preciosa Casa</span>
                <h2 class="text-white text-7xl mb-8">Il√°rraza y la Benjamina</h2>
                <p class="text-3xl mb-12">
                    En noviembre de 1924 comienza la construcci√≥n de su hogar definitivo en Il√°rraza. All√≠ nacer√≠a la √∫ltima hija, Finitxu (1927).
                </p>
                
                <!-- ACTIVIDAD 6: ORDENAR NACIMIENTOS (L√≠nea 415 aproximadamente) -->
                <div class="game-card mx-auto border-gold bg-white">
                    <div class="flex items-center mb-6 justify-center">
                        <div class="p-3 bg-forest rounded-full mr-4"><i class="fas fa-sort-numeric-up-alt text-2xl text-white"></i></div>
                        <h3 class="font-display text-3xl font-bold text-forest">Desaf√≠o: Orden de Nacimiento</h3>
                    </div>
                    <p class="mb-6 text-gray-700 text-2xl">Haz clic en los nombres de los hijos para colocarlos en orden cronol√≥gico (1¬∫ al 5¬∫):</p>
                    
                    <div id="birth-sequence-container">
                        <!-- Contenedor de elementos desordenados (Se llena por JS) -->
                        <div class="grid grid-cols-5 gap-2 justify-center max-w-4xl mx-auto mb-6" id="draggable-birth">
                            <!-- Los items interactivos (nombres) se generan aqu√≠ -->
                        </div>
                        <!-- Slots para ordenar (Drop Targets) -->
                        <div id="birth-drop-targets" class="grid grid-cols-5 gap-2 max-w-4xl mx-auto">
                            <div class="drop-target" data-target="1"><span class="text-lg">1¬∫</span></div>
                            <div class="drop-target" data-target="2"><span class="text-lg">2¬∫</span></div>
                            <div class="drop-target" data-target="3"><span class="text-lg">3¬∫</span></div>
                            <div class="drop-target" data-target="4"><span class="text-lg">4¬∫</span></div>
                            <div class="drop-target" data-target="5"><span class="text-lg">5¬∫</span></div>
                        </div>
                    </div>
                    <button id="check-birth-sequence" class="btn-action w-full mt-6">Validar Secuencia</button>
                    <div id="birth-sequence-feedback" class="feedback-msg"></div>
                </div>
            </div>
        </div>

        <!-- 11. CRONOLOG√çA SIMPLE -->
        <div class="section">
             <div class="max-w-[1400px] w-full text-center">
                <span class="text-forest font-bold uppercase tracking-widest text-xl border-b-4 border-forest">Cap√≠tulo 8: Eventos Clave</span>
                <h2 class="text-forest text-7xl mb-8">Cronolog√≠a de Eventos</h2>
                <p class="text-3xl mb-12">
                    Elige el orden correcto de estos tres eventos fundamentales:
                </p>
                
                <!-- JUEGO 4: ORDENAR -->
                <div class="game-card mx-auto border-forest bg-white">
                    <h3 class="font-display text-4xl mb-6 text-forest">üéÆ Ordena la Historia</h3>
                    <p class="text-2xl mb-8">Haz clic en los eventos en orden cronol√≥gico (1¬∫, 2¬∫, 3¬∫)</p>
                    
                    <div class="flex flex-col gap-4 max-w-2xl mx-auto">
                        <button class="btn-action w-full bg-white text-ink border-2 border-gray-300 hover:bg-forest hover:text-white text-left" onclick="checkOrder(2, this)">1. Gripe Espa√±ola</button>
                        <button class="btn-action w-full bg-white text-ink border-2 border-gray-300 hover:bg-forest hover:text-white text-left" onclick="checkOrder(1, this)">2. Boda en Lezo</button>
                        <button class="btn-action w-full bg-white text-ink border-2 border-gray-300 hover:bg-forest hover:text-white text-left" onclick="checkOrder(3, this)">3. Casa Il√°rraza</button>
                    </div>
                    <div id="fb-order" class="feedback-msg"></div>
                </div>
            </div>
        </div>

        <!-- 12. MUDANZA FINAL Y EXAMEN -->
        <div class="section bg-gold" style="border-bottom: none;">
            <div class="max-w-[1200px] w-full text-center">
                <span class="text-ink font-bold uppercase tracking-widest text-xl border-b-4 border-ink">Cap√≠tulo 9: La Despedida</span>
                <h2 class="text-ink text-7xl mb-8">Manuel Iradier 74</h2>
                <p class="text-3xl mb-8 text-ink">
                    La familia vivi√≥ en Il√°rraza hasta el a√±o 1955, cuando se mudaron definitivamente a Vitoria, a la calle Manuel Iradier 74.
                </p>
                <p class="text-3xl mb-16 text-ink">
                    Final de la Historia: √Ångel Guevara falleci√≥ en 1965 y Josefina J√°uregui en 1975.
                </p>
                
                <!-- GRAN EXAMEN -->
                <div class="game-card mx-auto border-ink shadow-2xl bg-white">
                    <h2 class="text-5xl font-display text-ink mb-4">¬°DEMUESTRA CU√ÅNTO SABES!</h2>
                    <p class="text-2xl text-gray-500 mb-12 uppercase tracking-widest">Trivial Familiar</p>

                    <div id="quiz-container">
                        <div class="flex justify-between border-b-4 border-gray-200 pb-4 mb-8 text-2xl font-bold text-gray-400">
                            <span id="q-progress">Pregunta 1/10</span>
                            <span>Puntos: <span id="q-score" class="text-forest">0</span></span>
                        </div>
                        
                        <h3 id="q-text" class="text-4xl font-bold mb-12 text-ink min-h-[120px] flex items-center justify-center">...</h3>
                        
                        <div id="q-options" class="grid grid-cols-1 gap-6"></div>
                    </div>

                    <div id="quiz-win" class="hidden py-12">
                        <i class="fas fa-crown text-8xl text-gold mb-8 animate-bounce"></i>
                        <h3 class="text-6xl font-display text-ink mb-6">¬°Felicidades!</h3>
                        <p class="text-3xl mb-12">Puntuaci√≥n Final: <span id="final-score" class="font-bold text-forest"></span></p>
                        <button class="btn-action bg-ink text-white" onclick="location.reload()">Volver al Inicio</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Confetti Canvas -->
    <canvas id="confetti-canvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000;"></canvas>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script>
        // --- DATA ---
        const quizData = [
            {q: "¬øEn qu√© a√±o se casaron √Ångel y Josefina?", a: ["1916", "1920", "1910"], c: 0},
            {q: "¬øQu√© profesi√≥n ten√≠a Telesforo?", a: ["M√©dico", "Confitero", "Minero"], c: 1},
            {q: "¬øQui√©n muri√≥ en 1918 en Zalduendo?", a: ["Telesforo", "√Ångel (padre)", "Pedro"], c: 0},
            {q: "¬øQu√© trajo Pedro J√°uregui a Maestu?", a: ["Luz El√©ctrica", "Agua Corriente"], c: 0},
            {q: "¬øEn qu√© fue √Ångel a la pedida de mano?", a: ["Autom√≥vil", "Caballo", "Tren"], c: 0},
            {q: "¬øD√≥nde naci√≥ Finitxu?", a: ["Il√°rraza", "Vitoria", "Junguitu"], c: 0},
            {q: "¬øQu√© hijo sobrevivi√≥ a la gripe en 1918?", a: ["Jos√©", "Luis"], c: 0},
            {q: "¬øDe qu√© muri√≥ Felipa Ajuria en 1922?", a: ["Pulmon√≠a (sin medicinas)", "Gripe"], c: 0},
            {q: "¬øA d√≥nde se mud√≥ la familia en 1955?", a: ["Manuel Iradier 74", "Calle Francia"], c: 0},
            {q: "¬øCu√°ntos km ten√≠a su billete de tren de novios?", a: ["6.000 km", "1.000 km", "3.000 km"], c: 0}
        ];
        let qIdx = 0, score = 0;
        let connectSelected = 0; // State for Hitos activity
        let orderStep = 0; // State for Order activity

        // Birth data used for the new interactive element (cleaned of dates in display text)
        // El orden correcto es 1. Jos√© (1917), 2. √Ångel (1920), 3. Est√≠baliz (1922), 4. Luis Mar√≠a (1924), 5. Finitxu (1927)
        const BIRTH_ITEMS_DATA = [
            { name: 'Jos√©', order: '1', display: 'Jos√© (Zalduendo)' },
            { name: '√Ångel', order: '2', display: '√Ångel (Vitoria)' },
            { name: 'Est√≠baliz', order: '3', display: 'Est√≠baliz (Junguitu)' },
            { name: 'Luis Mar√≠a', order: '4', display: 'Luis Mar√≠a (Junguitu)' },
            { name: 'Finitxu', order: '5', display: 'Finitxu (Il√°rraza)' }
        ];
        
        // --- CONTEXT DATA (Para ventanas "Saber M√°s") ---
        const CONTEXT_DATA = {
            'context-tele': "El dato m√°s antiguo que he podido encontrar del linaje Guevara se remonta al a√±o 1826 en el que Santiago Guevara y V√©lez de Mendiz√°bal contrae matrimonio en Junguitu con Gregoria √Ålvarez de Arcaya y D√≠az de Durana. Telesforo Guevara (1843) contrae matrimonio hacia 1867 con Felipa Ajuria I√±urritegui (1845), hija de Francisco Ajuria (m√©dico) y de Felipa I√±urritegui. Telesforo era Confitero y vecino de Vitoria.",
            
            'context-propiedades': "Telesforo era Confitero. En 1880 adquiere una casa en C/Barreras, 11 (hoy C/Independencia) de 73 m¬≤ por 10.750 Ptas. En 1899 compra una casa en C/Francia n¬∫ 5 de 151m¬≤ con patio por 11.500 Ptas. Ten√≠a fincas en Matauco, Arbulo, Argando√±a, etc. valoradas en 4.525 Ptas. Su Comercio estaba en C/ Nueva Dentro.",
            
            'context-jauregui': "El antepasado J√°uregui m√°s antiguo es Raimundo J√°uregui Az√°ceta (Maestu, 1750). Pedro Valent√≠n J√°uregui Querejazu (1851), 'El Regalao', era hijo de Jos√© Joaqu√≠n J√°uregui y Jacinta Querejazu. Pedro viv√≠a de rentas e intereses, fue diputado provincial y cofundador de la Sociedad de Asfaltos de Leorza.",
            
            'context-infancia': "Pedro J√°uregui y Guadalupe Zumalde tuvieron 3 hijos: Josefa (Josefina, 1893), Jos√© (Pepe, 1896) e In√©s (1899). In√©s muri√≥ con 1 a√±o y Guadalupe falleci√≥ en 1901 por tristeza. Josefina tuvo una infancia dif√≠cil con su madrastra Elvira Mart√≠nez de Lecea. Pedro J√°uregui falleci√≥ en 1930 de gangrena diab√©tica.",
            
            'context-ajuar': "El ajuar fue provisto por Obdulia Echevarr√≠a de Hern√°ndez (Modista) y Fernando Vicente (Ropa Blanca de Lujo). Para el viaje de novios compraron un billete para recorrer 6.000 kil√≥metros en tren en primera clase. La boda fue en Lezo porque Est√≠baliz estaba en obras y Pepe hac√≠a la mili en San Sebasti√°n.",
            
            'context-gripe': "En febrero de 1918 comenz√≥ la pandemia de la gripe. El 10 de octubre murieron en la casa de Zalduendo, Telesforo (padre de √Ångel) y la sirvienta. El peque√±o Jos√©, que cumpl√≠a 1 a√±o, estuvo muy grave. √Ångel dej√≥ su plaza de m√©dico y se fueron a Vitoria."
        };

        // --- FUNCIONES DE INTERACCI√ìN ---

        // Local TTS (Voz de √Ålava/Euskera)
        function narrateChapter(button) {
            // ... (TTS logic remains the same)
            if (!('speechSynthesis' in window)) {
                console.log("La funci√≥n de audio no est√° disponible en este navegador.");
                return;
            }

            const chapter = button.closest('.section');
            let textToSpeak = '';
            chapter.querySelectorAll('h2, h3, p, li').forEach(el => {
                // Excluir texto de juegos y botones de contexto
                if (!el.closest('.game-card') && !el.closest('.btn-context')) {
                    textToSpeak += el.textContent.trim() + '. ';
                }
            });
            
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }

            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = 'es-ES'; 
            utterance.rate = 0.95; 

            speechSynthesis.speak(utterance);
        }
        
        // Modal functions
        function openModal(title, contextKey) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').innerHTML = `<p>${CONTEXT_DATA[contextKey]}</p>`;
            document.getElementById('info-modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('info-modal').style.display = 'none';
        }

        // Helper para Feedback Visual
        function showFeedback(id, isSuccess, text) {
            const el = document.getElementById(id);
            el.style.display = 'block';
            el.innerHTML = isSuccess ? `<i class="fas fa-check-circle"></i> ${text}` : `<i class="fas fa-times-circle"></i> ${text}`;
            el.className = `feedback-msg ${isSuccess ? 'feedback-success' : 'feedback-error'}`;
            if(isSuccess) confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        }
        
        // 1. Precio Justo
        function updatePrice(val) {
            document.getElementById('priceVal').innerText = new Intl.NumberFormat('es-ES').format(val);
        }
        function checkPrice() {
            const val = document.getElementById('priceRange').value;
            const diff = Math.abs(val - 10750);
            if(diff < 1000) showFeedback('fb-price', true, '¬°EXACTO! Fueron 10.750 Ptas.');
            else showFeedback('fb-price', false, 'Casi... El precio real fue 10.750 Ptas.');
        }

        // 2. Conecta la Historia (Hitos)
        function toggleHitos(btn) {
             if (btn.disabled) return;
             // Toggle selection class
             btn.classList.toggle('selected');
        }

        function checkFinalConnect() {
            const btns = document.querySelectorAll('.hitos-option-card');
            const correctItems = ['asfalto', 'luz'];
            let correctCount = 0;
            let totalSelected = 0;
            
            btns.forEach(btn => {
                const item = btn.dataset.answer;
                const isSelected = btn.classList.contains('selected');
                
                if (isSelected) {
                    totalSelected++;
                    if (correctItems.includes(item)) {
                        correctCount++;
                        btn.style.borderColor = '#166534'; // Correct border
                    } else {
                        btn.style.borderColor = '#991b1b'; // Incorrect border
                    }
                } else if (correctItems.includes(item)) {
                    // Highlight missing correct answers (no visible border change needed for unselected correct)
                }
            });

            if (correctCount === correctItems.length && totalSelected === correctItems.length) {
                showFeedback('fb-connect', true, `¬°√âxito! Pedro fund√≥ las Minas de Asfalto y la Central El√©ctrica.`);
                btns.forEach(b => b.disabled = true);
            } else {
                showFeedback('fb-connect', false, 'Fallo. Aseg√∫rate de seleccionar *solo* los dos logros correctos.');
            }
        }


        // 3. Pregunta R√°pida (Wedding) is simple button click in HTML

        // 4. Ordenar Historia (Click en orden)
        function checkOrder(correctOrder, btn) {
            if (btn.disabled) return;
            orderStep++;
            
            if(orderStep === correctOrder) {
                btn.style.background = "#1b3a2b"; 
                btn.style.color = "white";
                btn.disabled = true;

                if (orderStep === 3) {
                    showFeedback('fb-order', true, '¬°Orden Perfecto! Boda en Lezo (1¬∫) -> Gripe Espa√±ola (2¬∫) -> Casa Il√°rraza (3¬∫).');
                    orderStep = 0;
                }
            } else {
                showFeedback('fb-order', false, 'Orden incorrecto. La historia comienza con la Boda en Lezo (1¬∫). Reinicia la p√°gina para probar otra vez.');
                orderStep = 0;
                // Deshabilitar botones solo si hay un error
                document.querySelectorAll('.section:nth-of-type(11) .game-card button').forEach(b => {
                    b.disabled = true;
                    b.style.background = "#631818";
                    b.style.color = "white";
                });
            }
        }
        
        // 6. Ordenar Nacimiento (Click to place)
        function initBirthSequenceActivity() {
            const dropTargets = document.querySelectorAll('#birth-drop-targets .drop-target');
            const itemsContainer = document.getElementById('draggable-birth');
            
            if (!itemsContainer) {
                console.error("Contenedor #draggable-birth no encontrado.");
                return;
            }

            // Limpiar y repoblar elementos
            itemsContainer.innerHTML = '';
            
            // Mezclar y colocar items
            const shuffledItems = [...BIRTH_ITEMS_DATA].sort(() => Math.random() - 0.5);

            shuffledItems.forEach(item => {
                const div = document.createElement('div');
                div.className = "birth-item text-ink transition shadow-sm";
                div.textContent = item.display; 
                div.dataset.order = item.order;
                div.dataset.name = item.name;

                // NO USAMOS DRAGGABLE, SOLO CLICK PARA SIMPLIFICAR
                // Draggable.create(div, { type: "x,y", bounds: itemsContainer.closest('.game-card') }); 

                div.onclick = function() { clickToMoveItem(this, dropTargets, itemsContainer); };
                itemsContainer.appendChild(div);
            });

            // Funci√≥n de movimiento al hacer click
            function clickToMoveItem(item, targets, source) {
                // Si el item est√° en un drop target, lo devolvemos al pool
                if (item.parentElement.classList.contains('drop-target')) {
                    source.appendChild(item);
                    // Restaurar clases al estado inicial del pool
                    item.classList.remove('bg-green-700', 'bg-red-700', 'bg-green-900');
                    item.classList.add('bg-white');
                    // Volver a a√±adir el bot√≥n de orden (solo si fue removido)
                    if(item.parentElement.querySelector('span')) {
                        item.parentElement.prepend(item.parentElement.querySelector('span'));
                    }
                } else {
                    // Si el item est√° en el pool, lo movemos al primer target vac√≠o
                    for(let t of targets) {
                        // Un target se considera vac√≠o si solo contiene el <span> con el n√∫mero de orden
                        if(t.children.length === 1 && t.children[0].tagName === 'SPAN') { 
                            t.appendChild(item);
                            item.classList.remove('bg-white');
                            item.classList.add('bg-green-700');
                            
                            // Ocultar el n√∫mero de orden (span) mientras el nombre est√° dentro
                            const spanElement = t.querySelector('span');
                            if (spanElement) {
                                t.removeChild(spanElement);
                            }
                            
                            break;
                        }
                    }
                }
            }

            // Funci√≥n de validaci√≥n
            document.getElementById('check-birth-sequence').onclick = function() {
                let correct = 0;
                let totalItems = BIRTH_ITEMS_DATA.length;
                let allSlotsFilled = true;

                dropTargets.forEach(t => {
                    const item = t.querySelector('.birth-item');
                    if (item) {
                        const expectedOrder = t.dataset.target;
                        
                        // A√±adir el span de orden de nuevo antes de colorear, para que el usuario sepa qu√© casilla es
                        if (!t.querySelector('span')) {
                           const orderSpan = document.createElement('span');
                           orderSpan.className = 'text-lg';
                           orderSpan.textContent = `${expectedOrder}¬∫`;
                           t.prepend(orderSpan);
                        }

                        if (item.dataset.order === expectedOrder) {
                            correct++;
                            item.classList.remove('bg-green-700', 'bg-red-700');
                            item.classList.add('bg-green-900');
                        } else {
                            item.classList.remove('bg-green-700', 'bg-green-900');
                            item.classList.add('bg-red-700');
                        }
                    } else {
                        allSlotsFilled = false;
                    }
                });

                const feedback = document.getElementById('birth-sequence-feedback');
                
                if(!allSlotsFilled) {
                    showFeedback('birth-sequence-feedback', false, 'Fallo: Debes llenar todas las posiciones (5 hijos).');
                    return;
                }

                if(correct === totalItems) {
                    showFeedback('birth-sequence-feedback', true, '¬°Cronolog√≠a Familiar Perfecta!');
                    this.disabled = true;
                } else {
                    showFeedback('birth-sequence-feedback', false, `Fallo en ${totalItems - correct} posiciones. Revisa el orden y el c√≥digo de colores.`);
                }
            };
        }

        // 5. Check Felipa
        function checkFelipa(isCorrect, btn) {
            document.querySelectorAll('.felipa-option').forEach(b => b.disabled = true);
            if (isCorrect) {
                 showFeedback('fb-felipa', true, '¬°Correcto! Pulmon√≠a por falta de medicaci√≥n.');
                 btn.classList.add('bg-green-900', 'border-green-400', 'text-white');
            } else {
                 showFeedback('fb-felipa', false, 'Incorrecto. La causa fue la falta de medicaci√≥n.');
                 btn.classList.add('bg-wine', 'border-wine', 'text-white');
            }
        }


        // 8. Gran Examen (Trivial)
        
        function loadQuiz() {
            if(qIdx >= quizData.length) {
                document.getElementById('quiz-container').style.display = 'none';
                document.getElementById('quiz-win').style.display = 'block';
                document.getElementById('final-score').innerText = `${score} / ${quizData.length * 100} puntos`;
                return;
            }
            const q = quizData[qIdx];
            document.getElementById('q-progress').innerText = `Pregunta ${qIdx+1}/${quizData.length}`;
            document.getElementById('q-score').innerText = score;
            document.getElementById('q-text').innerText = q.q;
            const opts = document.getElementById('q-options');
            opts.innerHTML = '';
            
            // Shuffle options
            let optionsWithIndex = q.a.map((answer, index) => ({ answer, isCorrect: index === q.c }));
            optionsWithIndex.sort(() => Math.random() - 0.5);
            
            optionsWithIndex.forEach(opt => {
                const isCorrect = opt.isCorrect;
                opts.innerHTML += `
                    <button class="w-full p-6 bg-white border-4 border-gray-200 hover:border-gold rounded-xl text-left font-bold text-2xl transition shadow-sm hover:shadow-md text-ink"
                            onclick="ansQuiz(${isCorrect}, this)">${opt.answer}</button>
                `;
            });
        }

        function ansQuiz(isCorrect, btn) {
            // Disable all buttons immediately after an answer
            document.querySelectorAll('#q-options button').forEach(b => b.disabled = true);

            if(isCorrect) {
                score += 100;
                btn.style.backgroundColor = '#dcfce7'; // Light green
                btn.style.borderColor = '#166534'; // Dark green
                confetti({ particleCount: 50, spread: 30, origin: { y: 0.5, x: 0.5 } }); 
            } else {
                btn.style.backgroundColor = '#fee2e2'; // Light red
                btn.style.borderColor = '#991b1b'; // Dark red
                // Highlight correct answer
                const correctAnswer = quizData[qIdx].a[quizData[qIdx].c];
                document.querySelectorAll('#q-options button').forEach(b => {
                    if (b.textContent === correctAnswer) {
                        b.style.backgroundColor = '#dcfce7';
                        b.style.borderColor = '#166534';
                    }
                });
            }
            
            // Move to next question after delay
            setTimeout(() => {
                qIdx++;
                loadQuiz();
            }, 1500);
        }
        
        // --- INICIALIZACI√ìN ---
        window.onload = () => {
            // GSAP loader animation
            gsap.to("#loader", {y:"-100%", duration:1.5, ease:"power4.inOut"});
            
            // Initialize main interactive parts
            initBirthSequenceActivity(); 
            
            // Start Quiz
            loadQuiz();
        };

        // --- UTILS ---
        
        window.scrollToSection = (id) => document.querySelector(id).scrollIntoView({behavior:'smooth'});
        
        // Confetti function
        window.confetti = (options) => {
            // Custom confetti implementation using the canvas element
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const particles = [];
            for(let i=0; i<options.particleCount; i++) {
                particles.push({
                    x: canvas.width * 0.5 + (Math.random() - 0.5) * options.spread * 2,
                    y: canvas.height * options.origin.y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 1) * 10,
                    c: ['#c5a059', '#1b3a2b', '#f7f1e3', '#631818'][Math.floor(Math.random()*4)]
                });
            }

            function loop() {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                let active = false;
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.5; // Gravity
                    if(p.y < canvas.height) active = true;
                    ctx.fillStyle = p.c;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 3, 0, Math.PI*2);
                    ctx.fill();
                });
                if(active) requestAnimationFrame(loop);
            }
            loop();
        }
    </script>
</body>
</html>
